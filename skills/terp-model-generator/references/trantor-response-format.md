# Trantor/Low-Code 平台响应格式说明

## 输入格式说明

用户提供从 Trantor 或 Low-Code 平台导出的完整响应对象。

## JSON 响应结构

```json
{
  "requestId": "t-67deccc8-df2d-4f46-b59f-679ce817de85",
  "success": true,
  "data": [
    {
      "key": "MALL$product_info_md",
      "name": "产品信息",
      "description": "",
      "access": "Private",
      "id": 262429,
      "props": {
        "config": {
          "persist": false,
          "system": false,
          "self": false
        },
        "tableName": "product_info_md",
        "mainField": "product_name",
        "type": "PERSIST",
        "physicalDelete": false,
        "originOrgIdEnabled": true,
        "orderNumberEnabled": false,
        "tenantIdEnabled": true
      },
      "children": [
        {
          "key": "product_code",
          "name": "产品编码",
          "alias": "productCode",
          "props": {
            "fieldType": "TEXT",
            "required": false,
            "unique": false,
            "compositeKey": false,
            "isSystemField": false,
            "autoGenerated": false,
            "comment": "产品编码。系统自动生成，规则待提供。",
            "columnName": "product_code",
            "length": 256,
            "encrypted": false,
            "relationField": false,
            "i18nEnabled": false
          }
        },
        {
          "key": "cost_price",
          "name": "成本价（元）",
          "alias": "costPrice",
          "props": {
            "fieldType": "NUMBER",
            "required": false,
            "unique": false,
            "columnName": "cost_price",
            "length": 20,
            "intLength": 20
          }
        },
        {
          "key": "product_type",
          "name": "产品类型",
          "alias": "productType",
          "props": {
            "fieldType": "OBJECT",
            "required": false,
            "comment": "产品类型。数据来源：产品分类；只能选择末级分类；仅选择"已启用"状态产品分类。",
            "columnName": "product_type",
            "relationMeta": {
              "relationType": "LINK",
              "currentModelAlias": "MALL$product_info_md",
              "currentModelFieldAlias": "productType",
              "relationModelAlias": "GEN_MD$gen_mat_cate_md",
              "sync": false,
              "linkRelationModel": false,
              "relationModelKey": "GEN_MD$gen_mat_cate_md"
            }
          }
        },
        {
          "key": "status",
          "name": "产品状态",
          "alias": "status",
          "props": {
            "fieldType": "ENUM",
            "required": false,
            "comment": "产品状态",
            "columnName": "status",
            "length": 256,
            "dictPros": {
              "multiSelect": false,
              "dictValues": [
                {
                  "_row_id_": "YpgkF0E",
                  "label": "启用",
                  "value": "ENABLE"
                },
                {
                  "_row_id_": "ZKDgNdk",
                  "label": "停用",
                  "value": "DISABLE"
                }
              ]
            }
          }
        },
        {
          "key": "attachment_cell_test",
          "name": "附件（细胞检测）",
          "alias": "attachmentCellTest",
          "props": {
            "fieldType": "ATTACHMENT",
            "required": false,
            "comment": "附件。",
            "columnName": "attachment_cell_test",
            "length": 4000,
            "attachmentProps": {
              "multi": true
            }
          }
        }
      ]
    }
  ]
}
```

## 关键部分说明

### 1. 响应根对象

- `success`: 请求是否成功
- `data`: 模型定义数组（通常只有一个元素）

### 2. 模型定义对象 (`data[0]`)

- `key`: 模型完整标识，格式：`{DOMAIN}${model_alias}`
- `name`: 模型中文名称
- `props.tableName`: 数据库表名

### 3. 字段数组 (`children`)

**关键属性**：
- `key`: 字段数据库列名（snake_case）
- `alias`: Java 字段名（camelCase）** - 使用这个！
- `name`: 字段中文名称
- `props`: 字段属性对象

### 4. 字段属性 (`props`)

**核心属性**：
- `fieldType`: 字段类型（TEXT, ENUM, NUMBER, OBJECT, DATE, ATTACHMENT, BOOLEAN）
- `columnName`: 数据库列名
- `comment`: 字段说明
- `isSystemField`: 是否系统字段（true 时需过滤）
- `length`: 字段长度
- `dictPros`: 枚举值定义（ENUM 时）
- `relationMeta`: 关联对象定义（OBJECT 时）
- `attachmentProps`: 附件属性（ATTACHMENT 时）
  - `multi`: 是否多文件（true → List<String>）

## 字段类型到 Java 类型的映射

| fieldType | Java 类型 | 说明 | 特殊处理 |
|-----------|-----------|-----|---------|
| TEXT | String | 文本类型 | 根据 length 决定 VARCHAR/TEXT |
| ENUM | String | 枚举类型 | 需要 @see 注释 + Dict 类 |
| NUMBER | BigDecimal | 数值类型 | 统一使用 BigDecimal |
| OBJECT | Long | 对象关联类型 | 在 PO 中存储为 Long 类型（ID） |
| DATE | java.time.LocalDateTime | 时间戳 | Trantor 的 DATE 实际是 DATETIME |
| DATETIME | java.time.LocalDateTime | 日期时间类型 | - |
| ATTACHMENT | List<String> | 附件类型 | multi=true → List<String>，需要 JacksonTypeHandler |
| BOOLEAN | Boolean | 布尔类型 | - |

## 系统字段过滤规则

以下字段标记为 `isSystemField: true`，**不要在 PO 中生成**（它们已在 BaseModel 中）：

```json
{
  "key": "id",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "created_by",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "updated_by",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "created_at",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "updated_at",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "version",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "deleted",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "request_id",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "origin_org_id",
  "props": {
    "isSystemField": true
  }
},
{
  "key": "tenant_id",
  "props": {
    "isSystemField": true
  }
}
```

## 枚举字段特殊处理

对于 fieldType 为 "ENUM" 的字段：

### 1. 在 PO 中添加 @see 注释

```java
/**
 * @see ProductInfoMdStatusDict
 */
@ApiModelProperty("产品状态")
@TableField("`status`")
private String status;
```

### 2. 在 DTO 中添加 @see 注释

```java
/**
 * @see ProductInfoMdStatusDict
 */
@ApiModelProperty("产品状态")
private String status;
```

### 3. 生成 Dict 接口类

**位置**: `{module}-spi/src/main/java/io/terminus/tsrm/{business-domain}/spi/dict/{module}/{EntityName}{PascalCaseFieldName}Dict.java`

**示例**：
```java
package io.terminus.tsrm.mall.spi.dict.mall;

/**
 * 产品状态(ProductInfoMdStatus)字典
 *
 * @author system
 * @since  2025-01-06 17:30:00
 */
public interface ProductInfoMdStatusDict {

    /**
     * 启用
     */
    String ENABLE = "ENABLE";

    /**
     * 停用
     */
    String DISABLE = "DISABLE";

}
```

**Dict 类命名规则**:
- `${EntityName}${PascalCaseFieldName}Dict`
- 例如：`ProductInfoMd` 实体的 `status` 字段 → `ProductInfoMdStatusDict`

**常量命名规则**:
- 将 `value` 转换为大写常量名
- 例如：`ENABLE` → `ENABLE`，`ENABLE`（已是） → `ENABLE`

## 附件字段特殊处理

对于 fieldType 为 "ATTACHMENT" 的字段：

```java
@TableField(value = "`attachment_cell_test`", typeHandler = JacksonTypeHandler.class)
@ApiModelProperty("附件（细胞检测）。")
private List<String> attachmentCellTest;
```

**特点**：
- 类型：`List<String>`
- 自动添加 `typeHandler = JacksonTypeHandler.class`
- 通常 `attachmentProps.multi === true`

## 对象关联字段（OBJECT 类型）

在 PO 中存储为 Long 类型（关联对象的 ID）：

```java
@TableField("`product_type`")
@ApiModelProperty("产品类型。数据来源：产品分类...")
private Long productType;
```

在 DTO 中可以是完整的 DTO 对象（需要确认用户需求）。

## 字段命名转换

### 源字段说明
```json
{
  "key": "product_code",
  "alias": "productCode"
}
```

### PO 字段
- Java 字段名：使用 `alias` → `productCode`
- 列名：使用 `columnName` 或 `key` → `product_code`

### DTO 字段
- 字段名：使用 `alias` → `productCode`

## 完整生成示例

### 输入

```json
{
  "requestId": "...",
  "success": true,
  "data": [
    {
      "key": "MALL$product_info_md",
      "name": "产品信息",
      "props": {
        "tableName": "product_info_md"
      },
      "children": [
        {
          "key": "product_code",
          "name": "产品编码",
          "alias": "productCode",
          "props": {
            "fieldType": "TEXT",
            "comment": "产品编码。",
            "columnName": "product_code"
          }
        },
        {
          "key": "status",
          "name": "产品状态",
          "alias": "status",
          "props": {
            "fieldType": "ENUM",
            "comment": "产品状态",
            "columnName": "status",
            "dictPros": {
              "dictValues": [
                {"label": "启用", "value": "ENABLE"},
                {"label": "停用", "value": "DISABLE"}
              ]
            }
          }
        },
        {
          "key": "attachment_cell_test",
          "name": "附件（细胞检测）",
          "alias": "attachmentCellTest",
          "props": {
            "fieldType": "ATTACHMENT",
            "comment": "附件。",
            "columnName": "attachment_cell_test",
            "attachmentProps": {
              "multi": true
            }
          }
        }
      ]
    }
  ]
}
```

### 生成的 PO

```java
package io.terminus.tsrm.mall.spi.model.mall.po;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableName;
import com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler;
import io.swagger.annotations.ApiModelProperty;
import io.terminus.common.api.model.BaseModel;
import lombok.Data;
import lombok.EqualsAndHashCode;

import java.util.List;

/**
 * (product_info_md)存储模型
 *
 * @author system
 * @since  2025-01-06 17:30:00
 */
@EqualsAndHashCode(callSuper = true)
@Data
@TableName("product_info_md")
public class ProductInfoMdPO extends BaseModel {
    private static final long serialVersionUID = 1L;

    @ApiModelProperty("产品编码。")
    @TableField("`product_code`")
    private String productCode;

    /**
     * @see ProductInfoMdStatusDict
     */
    @ApiModelProperty("产品状态")
    @TableField("`status`")
    private String status;

    @ApiModelProperty("附件。")
    @TableField(value = "`attachment_cell_test`", typeHandler = JacksonTypeHandler.class)
    private List<String> attachmentCellTest;
}
```