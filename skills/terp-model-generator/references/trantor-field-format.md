# Trantor/Low-Code 平台字段数组输入格式

## 输入格式说明

用户提供从 Trantor 或 Low-Code 平台导出的字段数组。每个字段对象包含：

```json
[
  {
    "key": "item_code",
    "name": "编码",
    "props": {
      "fieldType": "TEXT",
      "required": false,
      "unique": false,
      "compositeKey": false,
      "isSystemField": false,
      "autoGenerated": false,
      "comment": "编码",
      "columnName": "item_code",
      "length": 256,
      "encrypted": false,
      "relationField": false,
      "i18nEnabled": false
    }
  }
]
```

## 字段类型到 Java 类型的映射

| fieldType | Java 类型 | 说明 |
|-----------|-----------|-----|
| TEXT | String | 文本类型，根据长度决定是否使用 TEXT |
| ENUM | String | 枚举类型，存储为字符串，需要添加 @see 注释 |
| NUMBER | BigDecimal | 数值类型，统一使用 BigDecimal |
| OBJECT | Long | 对象关联类型，在 PO 中存储为 Long 类型（ID） |
| DATE | java.time.LocalDate | 日期类型 |
| DATETIME | java.time.LocalDateTime | 日期时间类型 |

## 枚举字段特殊处理

对于 fieldType 为 "ENUM" 的字段，需要：

### 1. 在 PO 中添加 @see 注释

```java
/**
 * @see SrmMalItemMdItemTypeDict
 */
@ApiModelProperty("类型")
@TableField("`item_type`")
private String itemType;
```

### 2. 在 DTO 中添加 @see 注释

```java
/**
 * @see SrmMalItemMdItemTypeDict
 */
@ApiModelProperty("类型")
private String itemType;
```

### 3. 生成对应的 Dict 接口类

**Dict 类位置**: `{module}-spi/src/main/java/io/terminus/tsrm/{package}/spi/dict/{module}/{EntityName}{PascalCaseFieldName}Dict.java`

**Dict 类模板**:
```java
package io.terminus.tsrm.{package}.spi.dict.{module};

/**
 * {field_name}({EntityName}{PascalCaseFieldName})字典
 *
 * @author {author}
 * @since  {timestamp}
 */
public interface {EntityName}{PascalCaseFieldName}Dict {

    /**
     * {label}
     */
    String {CONSTANT_VALUE} = "{value}";

}
```

**Dict 类命名规则**:
- `${EntityName}{PascalCaseFieldName}Dict`
- 例如：`SrmMalItemMd` 实体的 `item_type` 字段 → `SrmMalItemMdItemTypeDict`

**常量命名规则**:
- 将 `value` 转换为大写常量名
- 例如：`electronic` → `ELECTRONIC`，`paper` → `PAPER`

完整示例：

输入：
```json
{
  "key": "report_format",
  "name": "报告形式",
  "props": {
    "fieldType": "ENUM",
    "comment": "报告形式。",
    "columnName": "report_format",
    "dictPros": {
      "dictValues": [
        {"label": "电子版", "value": "electronic"},
        {"label": "纸质版", "value": "paper"}
      ]
    }
  }
}
```

**生成的 PO 字段**：
```java
/**
 * @see TestReportReportFormatDict
 */
@ApiModelProperty("报告形式。")
@TableField("`report_format`")
private String reportFormat;
```

**生成的 DTO 字段**：
```java
/**
 * @see TestReportReportFormatDict
 */
@ApiModelProperty("报告形式。")
private String reportFormat;
```

生成的 Dict 接口：
```java
package io.terminus.tsrm.onlinemall.spi.dict.item;

/**
 * 报告形式(TestReportReportFormat)字典
 *
 * @author system
 * @since  2025-01-06 16:40:00
 */
public interface TestReportReportFormatDict {

    /**
     * 电子版
     */
    String ELECTRONIC = "electronic";

    /**
     * 纸质版
     */
    String PAPER = "paper";

}
```

## 特殊字段处理

### OBJECT 类型（关联对象）

在 PO 中，OBJECT 类型字段存储为 Long 类型（关联对象的 ID）：

```java
// 输入：fieldType = "OBJECT"
// 输出：
@TableField("`supplier`")
private Long supplier;
```

### 数组/列表类型

对于列表类型，需要添加 JacksonTypeHandler：

```java
@TableField(value = "`item_image`", typeHandler = JacksonTypeHandler.class)
private List<String> itemImage;
```

## 字段命名转换

### Java 字段名（驼峰命名）
- `item_code` → `itemCode`
- `approval_status` → `approvalStatus`
- `contract_line` → `contractLine`

### 数据库列名（蛇形命名）
- 使用 `props.columnName`，如果不存在则使用 `key`
- 用反引号包裹：`@TableField("`item_code`")`

## 示例：从字段数组生成 PO

### 输入字段数组

```json
[
  {"key":"item_code","name":"编码","props":{"fieldType":"TEXT","comment":"编码","columnName":"item_code"}},
  {"key":"item_name","name":"名称","props":{"fieldType":"TEXT","comment":"名称","columnName":"item_name"}},
  {"key":"price","name":"售价","props":{"fieldType":"NUMBER","comment":"价格","columnName":"price","scale":2}},
  {"key":"supplier","name":"供应商","props":{"fieldType":"OBJECT","comment":"供应商","columnName":"supplier"}}
]
```

### 生成的 PO

```java
package io.terminus.tsrm.onlinemall.spi.model.item.po;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableName;
import io.swagger.annotations.ApiModelProperty;
import io.terminus.common.api.model.BaseModel;
import lombok.Data;
import lombok.EqualsAndHashCode;

import java.math.BigDecimal;

/**
 * (SrmMalItemMd)存储模型
 *
 * @author system
 * @since 2025-01-06 16:30:00
 */
@EqualsAndHashCode(callSuper = true)
@Data
@TableName("srm_mal_item_md")
public class SrmMalItemMdPO extends BaseModel {
    private static final long serialVersionUID = 1L;

    @ApiModelProperty("编码")
    @TableField("`item_code`")
    private String itemCode;

    @ApiModelProperty("名称")
    @TableField("`item_name`")
    private String itemName;

    @ApiModelProperty("售价")
    @TableField("`price`")
    private BigDecimal price;

    @ApiModelProperty("供应商")
    @TableField("`supplier`")
    private Long supplier;
}
```

## 解析流程

### 1. 解析目标实体
- 从实体路径提取包名、类名、模块名
- 例如：`io.terminus.tsrm.onlinemall.spi.model.item.po.SrmMalItemMdPO`
  - 包名：`io.terminus.tsrm.onlinemall.spi.model.item.po`
  - 类名：`SrmMalItemMdPO`
  - 模块名：`item`
  - 表名：`srm_mal_item_md`（类名转蛇形）

### 2. 遍历字段数组
- 读取每个字段的 `key`
- 读取 `props.fieldType` 映射到 Java 类型
- 读取 `props.comment` 作为注解描述
- 读取 `props.columnName` 作为数据库列名

### 3. 生成代码
- 为每个字段生成：
  - `@ApiModelProperty` 注解（comment）
  - `@TableField` 注解（column name, type handler if needed）
  - Java 字段声明

## 完整示例文件

查看 `examples/SrmMalItemMdPO.java` 获取完整示例。